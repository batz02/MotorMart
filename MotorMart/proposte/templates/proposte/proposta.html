<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MotorMart - Proposta</title>
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href='{% static "./css/bootstrap.min.css" %}' type="text/css">
    <link rel="stylesheet" href='{% static "./css/elegant-icons.css" %}' type="text/css">
    <link rel="stylesheet" href='{% static "./css/nice-select.css" %}' type="text/css">
    <link rel="stylesheet" href='{% static "./css/magnific-popup.css" %}' type="text/css">
    <link rel="stylesheet" href='{% static "./css/jquery-ui.min.css" %}' type="text/css">
    <link rel="stylesheet" href='{% static "./css/owl.carousel.min.css" %}' type="text/css">
    <link rel="stylesheet" href='{% static "./css/slicknav.min.css" %}' type="text/css">
    <link rel="stylesheet" href='{% static "./css/style.css" %}' type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Header Section Begin -->
    <header class="header">
        <div class="container">
            <div class="row">
                <div class="col-lg-2">
                    <div class="header__logo">
                        <a href="{% url 'home' %}"><img src="{% static "./img/logo-new.png" %}" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-10">
                    <div class="header__nav">
                        <nav class="header__menu">
                            <ul>
                                {% if user.is_authenticated %}
                                    <li>Benvenuto, {{ user.username }}</li>
                                {% endif %}
                                <li><a href="{% url 'home' %}">Home</a></li>
                                <li><a href="{% url 'annunci:annunci_list' %}">Annunci</a></li>
                                <li><a href="{% url 'profile' %}">Profilo</a></li>
                                <li><a href="{% url 'chat:chat_list' %}">Chat</a></li>
                            </ul>
                        </nav>

                        {% if user.is_authenticated %}
                            <div class="header__nav__widget">
                                <form method="get" action="{% url 'annunci:create' %}">
                                    <button class="primary-btn">Crea annuncio</button>
                                </form>
                            </div>
                            <div class="header__nav__widget">
                                <form id="logout-form" method="post" action="{% url 'logout' %}">
                                    {% csrf_token %}
                                    <button class="primary-btn">Logout</button>
                                </form>
                            </div>
                        
                        {% else %}
                            <div class="header__nav__widget">
                                <a href="{% url 'login' %}" class="primary-btn">Login</a>
                                <a href="{% url 'register' %}" class="primary-btn">Registrazione</a>
                            </div>
                        {% endif %}

                    </div>
                </div>
            </div>
            <div class="canvas__open">
                <span class="fa fa-bars"></span>
            </div>
        </div>
    </header>
    <!-- Header Section End -->

    <!-- Hero Section Begin -->
    <section class="hero spad set-bg" data-setbg="{% static "./img/hero-bg-created.jpg" %}">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-5">
                    <div class="hero__tab">
                        <ul class="nav nav-tabs" role="tablist">
                            
                            
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="hero__tab__form">
                                    
                                    <center>
                                        <h3 style="padding-bottom: 25px;">Proposte:</h3>
                                        {% if messages %}
                                            {% for m in messages %}
                                                <p>{{ m }}</p>
                                            {% endfor %}
                                        {% endif %}
                                        
                                        <!-- Only show proposals if the user is the listing owner -->
                                        {% if request.user == listing.utente %}
                                            {% for proposal in proposals %}
                                                <p>Prezzo proposto: {{ proposal.prezzo }} da {{ proposal.utente.username }}
                                                {% if proposal.accettata is None %}
                                                    {% if listing.venduto == None %}
                                                        <a href="{% url 'proposte:accept_proposal' proposal.id %}">Accetta</a>
                                                        <a href="{% url 'proposte:reject_proposal' proposal.id %}">Rifiuta</a>
                                                    {% endif %}
                                                {% elif proposal.accettata %}
                                                    <span>Accettata</span>
                                                {% else %}
                                                    <span>Rifiutata</span>
                                                {% endif %}
                                                </p>
                                            {% empty %}
                                                <p>Non ci sono proposte</p>
                                            {% endfor %}
                                        {% endif %}

                                        <!-- Allow non-owners to submit a proposal -->
                                        {% if request.user != listing.utente %}
                                            {% for proposal in proposals %}
                                                {% if request.user == proposal.utente %}
                                                    {% if proposal.accettata == None %}
                                                        <p>Prezzo proposto {{ proposal.prezzo }} - in attesa
                                                    {% endif %}
                                                    {% if proposal.accettata == True %}
                                                        <p>Prezzo proposto {{ proposal.prezzo }} - accettata
                                                    {% endif %}
                                                    {% if proposal.accettata == False %}
                                                        <p>Prezzo proposto {{ proposal.prezzo }} - rifiutata
                                                    {% endif %}
                                                {% endif %}
                                            {% endfor %}
                                            {% if listing.venduto == True %}
                                                <p>Automobile venduta
                                            {% else %}
                                            <form method="POST">
                                                {% csrf_token %}
                                                {{ form.as_p }}
                                                <button type="submit" name="submit_proposal">Invia proposta</button>
                                            </form>
                                            {% endif %}
                                        {% endif %}
                                      </center>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Hero Section End -->

    <!-- Js Plugins -->
    <script src="{% static "./js/jquery-3.3.1.min.js" %}"></script>
    <script src="{% static "./js/bootstrap.min.js" %}"></script>
    <script src="{% static "./js/jquery.nice-select.min.js" %}"></script>
    <script src="{% static "./js/jquery-ui.min.js" %}"></script>
    <script src="{% static "./js/jquery.magnific-popup.min.js" %}"></script>
    <script src="{% static "./js/mixitup.min.js" %}"></script>
    <script src="{% static "./js/jquery.slicknav.js" %}"></script>
    <script src="{% static "./js/owl.carousel.min.js" %}"></script>
    <script src="{% static "./js/main.js" %}"></script>
</body>

</html>